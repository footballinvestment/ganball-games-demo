<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸº GÄnCuju</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <div
        class="header"
        style="
          background: linear-gradient(
            135deg,
            #ff6b35 0%,
            #f7931e 50%,
            #ffd700 100%
          );
        "
      >
        <div class="mode-toggle">
          <button class="mode-btn active" data-mode="basic">Alap MÃ³d</button>
          <button class="mode-btn" data-mode="partner">ğŸ’ Partner MÃ³d</button>
        </div>
        <h1>ğŸº GÄnCuju</h1>
        <p id="subtitle">4000 Ã‰ves Åsi KÃ­nai Technika GenerÃ¡tor - Alap MÃ³d</p>
        <div style="margin-top: 20px">
          <button class="back-btn" onclick="window.location.href='index.html'">
            â† Vissza a Hubra
          </button>
        </div>
      </div>

      <div class="content">
        <!-- Touch Count Section -->
        <div class="section">
          <div class="section-title">âš¡ Ã‰rintÃ©sek SzÃ¡ma</div>
          <div class="touch-count-selector">
            <div class="touch-count-btn" data-count="1">1 Ã‰rintÃ©s</div>
            <div class="touch-count-btn active" data-count="2">2 Ã‰rintÃ©s</div>
            <div class="touch-count-btn" data-count="3">3 Ã‰rintÃ©s</div>
            <div class="touch-count-btn free-mode" data-count="free">
              <div>ğŸ² Szabad VÃ¡lasztÃ¡s</div>
              <div
                style="font-size: 0.8em; opacity: 0.7"
                id="free-choice-label"
              >
                ğŸ’ Partner funkciÃ³
              </div>
            </div>
          </div>

          <!-- Touch Configuration -->
          <div class="touch-config" id="touch-config">
            <div class="touch-item-config">
              <div class="touch-label">1. Ã‰rintÃ©s</div>
              <div class="radio-group">
                <div
                  class="radio-btn active"
                  data-touch="1"
                  data-mode="generated"
                >
                  GenerÃ¡lt
                </div>
                <div class="radio-btn free" data-touch="1" data-mode="free">
                  Szabad ğŸ’
                </div>
              </div>
            </div>
            <div class="touch-item-config" id="touch-2-config">
              <div class="touch-label">2. Ã‰rintÃ©s</div>
              <div class="radio-group">
                <div
                  class="radio-btn active"
                  data-touch="2"
                  data-mode="generated"
                >
                  GenerÃ¡lt
                </div>
                <div class="radio-btn free" data-touch="2" data-mode="free">
                  Szabad ğŸ’
                </div>
              </div>
            </div>
            <div
              class="touch-item-config"
              id="touch-3-config"
              style="display: none"
            >
              <div class="touch-label">3. Ã‰rintÃ©s</div>
              <div class="radio-group">
                <div
                  class="radio-btn active"
                  data-touch="3"
                  data-mode="generated"
                >
                  GenerÃ¡lt
                </div>
                <div class="radio-btn free" data-touch="3" data-mode="free">
                  Szabad ğŸ’
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Cultures Section -->
        <div class="section">
          <div class="section-title">ğŸŒ OpcionÃ¡lis KultÃºrÃ¡k</div>
          <div class="cultures-grid">
            <div class="culture-card active" data-culture="cuju">
              <div class="checkbox"></div>
              <div class="culture-title">ğŸº CuJu TechnikÃ¡k</div>
              <div class="culture-desc">4000 Ã©ves kÃ­nai technikÃ¡k</div>
            </div>
            <div class="culture-card active" data-culture="mezoamerikai">
              <div class="checkbox"></div>
              <div class="culture-title">ğŸ›ï¸ Mezoamerikai</div>
              <div class="culture-desc">CsÃ­pÅ‘ technikÃ¡k</div>
            </div>
            <div class="culture-card" data-culture="dominantFoot">
              <div class="checkbox"></div>
              <div class="culture-title">ğŸ¦¶ DominÃ¡ns Oldal MÃ³d</div>
              <div class="culture-desc">
                Jobb/Bal helyett DominÃ¡ns/GyengÃ©bb oldal
              </div>
            </div>
          </div>
        </div>

        <!-- Generate Section -->
        <div class="generate-section">
          <button
            class="generate-btn"
            onclick="generate()"
            style="
              background: linear-gradient(
                135deg,
                #ff6b35 0%,
                #f7931e 50%,
                #ffd700 100%
              );
            "
          >
            ğŸº Åsi GÄnCuju GenerÃ¡lÃ¡sa
          </button>
        </div>

        <!-- Results Section -->
        <div class="results" id="results">
          <div
            class="results-header"
            style="
              background: linear-gradient(
                135deg,
                #ff6b35 0%,
                #f7931e 50%,
                #ffd700 100%
              );
            "
          >
            <h2>âš¡ GenerÃ¡lt GÄnCuju Åsi Szekvencia</h2>
          </div>
          <div class="results-content" id="results-content"></div>
          <div class="stats-footer" id="stats"></div>
        </div>

        <!-- Game Recording Section -->
        <div class="game-recording-section" id="game-recording-section">
          <div class="game-step active" id="game-step-match-type">
            <div class="game-step-title">ğŸº Set TÃ­pus VÃ¡lasztÃ¡sa</div>
            <div class="match-type-selector">
              <div class="match-type-btn" data-points="15" data-time="180">
                <div class="match-points">15 PONT</div>
                <div class="match-time">3 perc</div>
              </div>
              <div class="match-type-btn" data-points="21" data-time="300">
                <div class="match-points">21 PONT</div>
                <div class="match-time">5 perc</div>
              </div>
              <div
                class="match-type-btn"
                data-points="25"
                data-time="420"
                id="game-match-25"
              >
                <div class="match-points">25 PONT</div>
                <div class="match-time">7 perc</div>
                <div class="partner-only">ğŸ’ Partner MÃ³d</div>
              </div>
            </div>
            <div style="text-align: center; margin-top: 20px">
              <button
                class="btn btn-primary"
                onclick="initializeGameSession()"
                id="init-game-btn"
                disabled
              >
                ğŸº CUJU GYAKORLÃS INDÃTÃSA (3 Set sorozat)
              </button>
            </div>
          </div>
          <div class="game-step hidden" id="game-step-ready">
            <div class="game-step-title">ğŸ CuJu GyakorlÃ¡s IndÃ­tÃ¡s</div>
            <div id="game-ready-content"></div>
          </div>
          <div class="game-step hidden" id="game-step-progress">
            <div class="game-step-title">âš¡ Åsi CuJu Folyamatban</div>
            <div id="game-progress-content"></div>
          </div>
          <div class="game-step hidden" id="game-step-summary">
            <div class="game-step-title">ğŸ† CuJu GyakorlÃ¡s Befejezve</div>
            <div id="game-summary-content"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Configuration
      let config = {
        mode: "basic",
        touchCount: 2,
        isFreeCount: false,
        touches: { 1: "generated", 2: "generated", 3: "generated" },
        cultures: { cuju: true, mezoamerikai: true, dominantFoot: false },
      };

      // Game State
      let gameState = {
        isActive: false,
        currentConfig: null,
        generatedResult: null,
        matchType: null,
        selectedPoints: 0,
        selectedTime: 0,
        currentStep: "match-type",
        sessionData: {
          matches: [],
          totalMatches: 3,
          currentMatch: 0,
          startTime: null,
          endTime: null,
        },
      };

      let GENERATED_RESULT = null;

      // GÄnCuju 19 Ancient Techniques
      const GANCUJU_TECHNIQUES = {
        hand: [
          { name: "Jobb kÃ©z", category: "hand" },
          { name: "Bal kÃ©z", category: "hand" },
        ],
        head: [
          { name: "Fej", category: "head" },
          { name: "Bal vÃ¡ll", category: "head" },
          { name: "Jobb vÃ¡ll", category: "head" },
        ],
        torso: [
          { name: "Mell", category: "torso" },
          { name: "HÃ¡t", category: "torso" },
          { name: "Bal csÃ­pÅ‘", category: "torso" },
          { name: "Jobb csÃ­pÅ‘", category: "torso" },
        ],
        leg: [
          { name: "Bal tÃ©rd", category: "leg" },
          { name: "Jobb tÃ©rd", category: "leg" },
          { name: "Bal sarok", category: "leg" },
          { name: "Jobb sarok", category: "leg" },
          { name: "Bal rÃ¼szt", category: "leg" },
          { name: "Jobb rÃ¼szt", category: "leg" },
          { name: "Bal belsÅ‘", category: "leg" },
          { name: "Jobb belsÅ‘", category: "leg" },
          { name: "Bal kÃ¼lsÅ‘", category: "leg" },
          { name: "Jobb kÃ¼lsÅ‘", category: "leg" },
        ],
      };

      const GANCUJU_LABELS = {
        hand: "âœ‹ KÃ©z Technika",
        head: "ğŸ¤• Fej & VÃ¡ll Technika",
        torso: "ğŸ’ª TÃ¶rzs Technika",
        leg: "ğŸ¦µ LÃ¡b Technika",
      };

      // GÄnFoottennis Techniques
      const TECHNIQUES = {
        serve: {
          modern: [
            "Jobb + BelsÅ‘",
            "Jobb + RÃ¼szt",
            "Jobb + KÃ¼lsÅ‘",
            "Jobb + Sarok",
            "Jobb + TÃ©rd",
            "Jobb + VÃ¡ll",
            "Bal + BelsÅ‘",
            "Bal + RÃ¼szt",
            "Bal + KÃ¼lsÅ‘",
            "Bal + Sarok",
            "Bal + TÃ©rd",
            "Bal + VÃ¡ll",
          ],
          cuju: ["Mell (CuJu)", "HÃ¡t (CuJu)"],
          mezoamerikai: ["Jobb + CsÃ­pÅ‘", "Bal + CsÃ­pÅ‘"],
          fejeles: [
            "Bal kÃ©z feldobÃ¡s + FejelÃ©s",
            "Jobb kÃ©z feldobÃ¡s + FejelÃ©s",
            "KÃ©t kÃ©z feldobÃ¡s + FejelÃ©s",
          ],
        },
        touch: {
          modern: [
            "Jobb + BelsÅ‘",
            "Jobb + RÃ¼szt",
            "Jobb + KÃ¼lsÅ‘",
            "Jobb + Sarok",
            "Jobb + TÃ©rd",
            "Jobb + VÃ¡ll",
            "Bal + BelsÅ‘",
            "Bal + RÃ¼szt",
            "Bal + KÃ¼lsÅ‘",
            "Bal + Sarok",
            "Bal + TÃ©rd",
            "Bal + VÃ¡ll",
          ],
          cuju: ["Mell (CuJu)", "HÃ¡t (CuJu)"],
          mezoamerikai: ["Jobb + CsÃ­pÅ‘", "Bal + CsÃ­pÅ‘"],
          fejeles: ["FejelÃ©s"],
        },
      };

      const CATEGORY_LABELS = {
        modern: "ğŸ¦¶ Modern Futball",
        cuju: "ğŸº 4000 Ã©ves CuJu",
        mezoamerikai: "ğŸ›ï¸ Mezoamerikai",
        fejeles: "ğŸ¤• FejelÃ©si",
        dominantside: "ğŸ¦¶ DominÃ¡ns/GyengÃ©bb Oldal",
      };

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        initEventListeners();
        updateUIForMode();
        updateTouchConfig();
        updateSessionCount();
      });

      function initEventListeners() {
        // Mode toggle
        document.querySelectorAll(".mode-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            document
              .querySelectorAll(".mode-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            config.mode = this.dataset.mode;
            updateUIForMode();
          });
        });

        // Touch count
        document.querySelectorAll(".touch-count-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            if (this.dataset.count === "free" && config.mode === "basic")
              return;
            document
              .querySelectorAll(".touch-count-btn")
              .forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            const count = this.dataset.count;
            config.isFreeCount = count === "free";
            config.touchCount = config.isFreeCount ? 0 : parseInt(count);
            updateTouchConfig();
          });
        });

        // Touch modes
        document.addEventListener("click", function (e) {
          if (e.target.classList.contains("radio-btn")) {
            if (e.target.dataset.mode === "free" && config.mode === "basic")
              return;
            const touch = e.target.dataset.touch;
            const mode = e.target.dataset.mode;
            document
              .querySelectorAll(`[data-touch="${touch}"]`)
              .forEach((btn) => btn.classList.remove("active"));
            e.target.classList.add("active");
            config.touches[touch] = mode;
          }
        });

        // Cultures
        document.querySelectorAll(".culture-card").forEach((card) => {
          card.addEventListener("click", function () {
            this.classList.toggle("active");
            const culture = this.dataset.culture;
            config.cultures[culture] = this.classList.contains("active");
          });
        });
      }

      function updateUIForMode() {
        const isPartner = config.mode === "partner";
        const freeChoiceBtn = document.querySelector('[data-count="free"]');
        const freeRadioBtns = document.querySelectorAll(
          '.radio-btn[data-mode="free"]'
        );
        const freeChoiceLabel = document.getElementById("free-choice-label");
        const subtitle = document.getElementById("subtitle");

        if (isPartner) {
          if (subtitle)
            subtitle.textContent =
              "4000 Ã‰ves Åsi KÃ­nai Technika GenerÃ¡tor - ğŸ’ Partner MÃ³d (1,000,000+ kombinÃ¡ciÃ³)";
          if (freeChoiceBtn) {
            freeChoiceBtn.style.opacity = "1";
            freeChoiceBtn.style.pointerEvents = "auto";
          }
          if (freeChoiceLabel) {
            freeChoiceLabel.textContent = "âœ… ElÃ©rhetÅ‘";
            freeChoiceLabel.style.color = "#28a745";
          }
          freeRadioBtns.forEach((btn) => {
            btn.style.opacity = "1";
            btn.style.pointerEvents = "auto";
          });
        } else {
          if (subtitle)
            subtitle.textContent =
              "4000 Ã‰ves Åsi KÃ­nai Technika GenerÃ¡tor - Alap MÃ³d";
          if (freeChoiceBtn) {
            freeChoiceBtn.style.opacity = "0.5";
            freeChoiceBtn.style.pointerEvents = "none";
          }
          if (freeChoiceLabel) {
            freeChoiceLabel.textContent = "ğŸ’ Partner funkciÃ³";
            freeChoiceLabel.style.color = "#6c757d";
          }
          freeRadioBtns.forEach((btn) => {
            btn.style.opacity = "0.5";
            btn.style.pointerEvents = "none";
          });

          if (config.isFreeCount) {
            config.isFreeCount = false;
            config.touchCount = 2;
            document
              .querySelectorAll(".touch-count-btn")
              .forEach((b) => b.classList.remove("active"));
            document.querySelector('[data-count="2"]').classList.add("active");
          }

          config.touches[1] = "generated";
          config.touches[2] = "generated";
          config.touches[3] = "generated";
          document
            .querySelectorAll('.radio-btn[data-mode="generated"]')
            .forEach((btn) => btn.classList.add("active"));
        }
        updateTouchConfig();
      }

      function updateTouchConfig() {
        const configDiv = document.getElementById("touch-config");
        const touch2 = document.getElementById("touch-2-config");
        const touch3 = document.getElementById("touch-3-config");

        if (config.isFreeCount) {
          configDiv.classList.remove("show");
        } else {
          configDiv.classList.add("show");
          if (touch2)
            touch2.style.display = config.touchCount >= 2 ? "flex" : "none";
          if (touch3)
            touch3.style.display = config.touchCount >= 3 ? "flex" : "none";
        }
      }

      function updateSessionCount() {
        let sessionCount = parseInt(
          localStorage.getItem("ganball-total-sessions") || "0"
        );
        let gameStats = JSON.parse(
          localStorage.getItem("ganball-game-stats") || "{}"
        );
        if (!gameStats["gancuju"]) {
          gameStats["gancuju"] = { sessions: 0, lastPlayed: null };
        }
        gameStats["gancuju"].sessions++;
        gameStats["gancuju"].lastPlayed = new Date().toISOString();
        sessionCount++;
        localStorage.setItem("ganball-total-sessions", sessionCount.toString());
        localStorage.setItem("ganball-game-stats", JSON.stringify(gameStats));
      }

      // Generation Functions
      function generate() {
        const generateBtn = document.querySelector(".generate-btn");
        generateBtn.textContent = "ğŸ”„ GenerÃ¡lÃ¡s...";
        generateBtn.disabled = true;

        const result = {
          gancuju: generateGanCuju(),
          serve: generateServe(),
          touches: config.isFreeCount ? null : generateTouches(),
        };

        GENERATED_RESULT = result;
        displayResults(result);

        setTimeout(() => {
          generateBtn.textContent = "ğŸº Åsi GÄnCuju GenerÃ¡lÃ¡sa";
          generateBtn.disabled = false;
        }, 500);
      }

      function generateGanCuju() {
        const allTechniques = [
          ...GANCUJU_TECHNIQUES.hand,
          ...GANCUJU_TECHNIQUES.head,
          ...GANCUJU_TECHNIQUES.torso,
          ...GANCUJU_TECHNIQUES.leg,
        ];
        return allTechniques[Math.floor(Math.random() * allTechniques.length)];
      }

      function generateServe() {
        const availableTechniques = getAvailableTechniques("serve");
        const technique = getRandomTechnique(availableTechniques);
        return {
          technique: technique,
          category: getTechniqueCategory(technique, "serve"),
        };
      }

      function generateTouches() {
        const touches = [];
        for (let i = 1; i <= config.touchCount; i++) {
          if (config.touches[i] === "free") {
            touches.push({
              number: i,
              technique: null,
              category: "free",
              isFree: true,
            });
          } else {
            const availableTechniques = getAvailableTechniques("touch", i);
            const technique = getRandomTechnique(availableTechniques);
            touches.push({
              number: i,
              technique: technique,
              category: getTechniqueCategory(technique, "touch"),
              isFree: false,
            });
          }
        }
        return touches;
      }

      function getAvailableTechniques(type, touchNumber = null) {
        let techniques = [
          ...TECHNIQUES[type].modern,
          ...TECHNIQUES[type].fejeles,
        ];
        if (config.cultures.cuju)
          techniques = [...techniques, ...TECHNIQUES[type].cuju];
        if (config.cultures.mezoamerikai) {
          if (
            type === "serve" ||
            (touchNumber && touchNumber === config.touchCount)
          ) {
            techniques = [...techniques, ...TECHNIQUES[type].mezoamerikai];
          }
        }
        if (config.cultures.dominantFoot) {
          techniques = techniques.map((tech) =>
            tech
              .replace(/Jobb \+/g, "DominÃ¡ns Oldal +")
              .replace(/Bal \+/g, "GyengÃ©bb Oldal +")
          );
        }
        return techniques;
      }

      function getRandomTechnique(techniques) {
        return techniques[Math.floor(Math.random() * techniques.length)];
      }

      function getTechniqueCategory(technique, type) {
        let originalTechnique = technique;
        if (config.cultures.dominantFoot) {
          originalTechnique = technique
            .replace(/DominÃ¡ns Oldal \+/g, "Jobb +")
            .replace(/GyengÃ©bb Oldal \+/g, "Bal +");
        }
        for (const [category, techniques] of Object.entries(TECHNIQUES[type])) {
          if (techniques.includes(originalTechnique)) return category;
        }
        return "unknown";
      }

      function displayResults(result) {
        let html = `
                <div style="background: linear-gradient(135deg, #FF8A50, #FFAB40); border: 1px solid #FF6B35; border-radius: 12px; padding: 24px; margin-bottom: 24px; text-align: center;">
                    <div style="font-size: 1.4em; color: white; margin-bottom: 12px; font-weight: 600;">ğŸº GÄnCuju Åstechnika</div>
                    <div style="font-size: 1.6em; font-weight: 700; color: white; margin-bottom: 8px;">${
                      result.gancuju.name
                    }</div>
                    <div style="display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 0.85em; font-weight: 500; background: rgba(255,255,255,0.2); color: white;">
                        ${GANCUJU_LABELS[result.gancuju.category]}
                    </div>
                </div>
                <div style="text-align: center; margin: 32px 0; font-size: 1.5em; color: #FF6B35; font-weight: 600;">â¬‡ï¸ Majd â¬‡ï¸</div>
                <div style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); border: 1px solid #ffeaa7; border-radius: 12px; padding: 24px; margin-bottom: 32px; text-align: center;">
                    <div style="font-size: 1.3em; color: #856404; margin-bottom: 12px; font-weight: 600;">ğŸº SZERVA</div>
                    <div style="font-size: 1.4em; font-weight: 600; margin-bottom: 12px; color: #495057;">${
                      result.serve.technique
                    }</div>
                    <div style="display: inline-block; padding: 6px 16px; border-radius: 20px; font-size: 0.85em; font-weight: 500; background: #e3f2fd; color: #1565c0; border: 1px solid #bbdefb;">
                        ${CATEGORY_LABELS[result.serve.category]}
                    </div>
                </div>
            `;

        if (config.isFreeCount) {
          html += `<div style="text-align: center; margin: 32px 0; font-size: 1.5em; color: #FF6B35; font-weight: 600;">â¬‡ï¸ UtÃ¡na â¬‡ï¸</div>
                         <div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 16px; border-left: 4px solid #FF6B35;">
                             <div style="color: #FF6B35; font-size: 1.1em; font-weight: 600; margin-bottom: 8px;">ğŸ² Teljes Szabad JÃ¡tÃ©k</div>
                             <div style="font-size: 1.4em; font-weight: 600; margin-bottom: 12px; color: #495057;">A jÃ¡tÃ©kos mindent eldÃ¶nt</div>
                         </div>`;
        } else if (result.touches) {
          html += `<div style="text-align: center; margin: 32px 0; font-size: 1.5em; color: #FF6B35; font-weight: 600;">â¬‡ï¸ UtÃ¡na â¬‡ï¸</div>`;
          result.touches.forEach((touch) => {
            html += `<div style="background: white; border: 1px solid #e9ecef; border-radius: 8px; padding: 20px; margin-bottom: 16px; border-left: 4px solid #FF6B35;">
                                 <div style="color: #FF6B35; font-size: 1.1em; font-weight: 600; margin-bottom: 8px;">âš¡ ${
                                   touch.number
                                 }. Ã‰rintÃ©s</div>
                                 <div style="font-size: 1.4em; font-weight: 600; margin-bottom: 12px; color: #495057;">${
                                   touch.isFree
                                     ? "JÃ¡tÃ©kos dÃ¶nt"
                                     : touch.technique
                                 }</div>
                             </div>`;
          });
        }

        html += `<div style="background: linear-gradient(135deg, #8e24aa, #ab47bc); color: white; padding: 16px; border-radius: 8px; margin-top: 20px; text-align: center;">
                         <strong>ğŸº 4000 Ã‰VES HAGYOMÃNY:</strong> ${
                           result.gancuju.name
                         } Å‘stechnika â†’ ${result.serve.technique} szerva â†’ ${
          result.touches
            ? result.touches.length + " Ã©rintÃ©ses szekvencia"
            : "szabad jÃ¡tÃ©k"
        }
                     </div>
                     <div style="background: linear-gradient(135deg, #FF6B35, #F7931E); color: white; padding: 24px; border-radius: 12px; text-align: center; margin-top: 32px;">
                         <div style="font-size: 1.4em; font-weight: 700; margin-bottom: 8px;">ğŸº CuJu GyakorlÃ¡s IndÃ­tÃ¡sa</div>
                         <div style="opacity: 0.9; margin-bottom: 20px;">IndÃ­ts Å‘si CuJu gyakorlÃ¡st ezzel a generÃ¡lt szekvenciÃ¡val!</div>
                         <button style="background: rgba(255, 255, 255, 0.2); color: white; border: 2px solid white; padding: 16px 32px; font-size: 1.1em; font-weight: 600; border-radius: 8px; cursor: pointer;" onclick="startGameWithGeneratedConfig()">
                             ğŸ GYAKORLÃS INDÃTÃSA
                         </button>
                     </div>`;

        document.getElementById("results-content").innerHTML = html;
        const mode = config.isFreeCount
          ? "TELJES SZABAD JÃTÃ‰K"
          : `${config.touchCount} Ã‰RINTÃ‰S`;
        const modeText =
          config.mode === "partner" ? "ğŸ’ Partner MÃ³d" : "Alap MÃ³d";
        document.getElementById(
          "stats"
        ).innerHTML = `ğŸº MÃ³d: ${mode} | ${modeText} | âš½ GÄnCuju Åsi GenerÃ¡tor`;

        const results = document.getElementById("results");
        results.style.display = "block";
        results.scrollIntoView({ behavior: "smooth" });
      }

      // Game Functions
      function startGameWithGeneratedConfig() {
        if (!GENERATED_RESULT) {
          alert("âŒ Hiba: Nincs generÃ¡lt konfigurÃ¡ciÃ³!");
          return;
        }
        gameState.currentConfig = { ...config };
        gameState.generatedResult = GENERATED_RESULT;
        document
          .getElementById("game-recording-section")
          .classList.add("active");
        document
          .getElementById("game-recording-section")
          .scrollIntoView({ behavior: "smooth" });
        initializeMatchTypeSelection();
      }

      function initializeMatchTypeSelection() {
        const matchTypeBtns = document.querySelectorAll(".match-type-btn");
        const initBtn = document.getElementById("init-game-btn");
        matchTypeBtns.forEach((btn) => btn.classList.remove("active"));
        initBtn.disabled = true;

        const match25 = document.getElementById("game-match-25");
        if (config.mode === "basic") {
          match25.classList.add("disabled");
        } else {
          match25.classList.remove("disabled");
        }

        matchTypeBtns.forEach((btn) => {
          btn.addEventListener("click", function () {
            if (this.classList.contains("disabled")) return;
            matchTypeBtns.forEach((b) => b.classList.remove("active"));
            this.classList.add("active");
            gameState.selectedPoints = parseInt(this.dataset.points);
            gameState.selectedTime = parseInt(this.dataset.time);
            gameState.matchType = this.dataset.points + "_points";
            initBtn.disabled = false;
            initBtn.textContent = `ğŸº CUJU GYAKORLÃS INDÃTÃSA (3 Ã— ${gameState.selectedPoints} pontos set)`;
          });
        });
      }

      function initializeGameSession() {
        if (!gameState.selectedPoints) return;
        gameState.sessionData = {
          matches: [],
          totalMatches: 3,
          currentMatch: 0,
          startTime: new Date().toISOString(),
          endTime: null,
          configuration: { ...gameState.currentConfig },
          generatedResult: { ...gameState.generatedResult },
          matchType: gameState.matchType,
          points: gameState.selectedPoints,
          timeLimit: gameState.selectedTime,
        };
        gameState.isActive = true;
        showGameStep("ready");
        loadGameReadyContent();
      }

      function showGameStep(stepName) {
        document.querySelectorAll(".game-step").forEach((step) => {
          step.classList.remove("active");
          step.classList.add("hidden");
        });
        const targetStep = document.getElementById(`game-step-${stepName}`);
        if (targetStep) {
          targetStep.classList.remove("hidden");
          targetStep.classList.add("active");
          targetStep.scrollIntoView({ behavior: "smooth" });
        }
        gameState.currentStep = stepName;
      }

      function loadGameReadyContent() {
        const content = document.getElementById("game-ready-content");
        const setNum = gameState.sessionData.currentMatch + 1;
        content.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 20px;">ğŸº CuJu GyakorlÃ¡s ${setNum}/3</div>
                    <div style="font-size: 1.3em; margin-bottom: 20px; color: #FF6B35;">${
                      gameState.selectedPoints
                    } Pontos Set (${gameState.selectedTime} mÃ¡sodperc)</div>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="margin-bottom: 15px; color: #495057;">ğŸ“‹ GÄnCuju Szekvencia:</h4>
                        <div style="text-align: left; color: #6c757d;">
                            â€¢ MÃ³d: ${
                              gameState.currentConfig.mode === "partner"
                                ? "ğŸ’ Partner MÃ³d"
                                : "Alap MÃ³d"
                            }<br>
                            â€¢ Ã‰rintÃ©sek: ${
                              gameState.currentConfig.isFreeCount
                                ? "ğŸ² Szabad VÃ¡lasztÃ¡s"
                                : gameState.currentConfig.touchCount +
                                  " Ã©rintÃ©s"
                            }<br>
                            â€¢ KultÃºrÃ¡k: ${
                              Object.entries(gameState.currentConfig.cultures)
                                .filter(([k, v]) => v)
                                .map(([k, v]) => k)
                                .join(", ") || "Nincs"
                            }
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="startMatch()" style="font-size: 1.2em; padding: 16px 32px;">ğŸ CuJu Set ${setNum} INDÃTÃSA</button>
                    </div>
                </div>
            `;
      }

      function startMatch() {
        const matchData = {
          matchNumber: gameState.sessionData.currentMatch + 1,
          startTime: new Date().toISOString(),
          endTime: null,
          result: null,
          points: gameState.selectedPoints,
          timeLimit: gameState.selectedTime,
        };
        gameState.sessionData.matches.push(matchData);
        showGameStep("progress");
        loadGameProgressContent();
        startMatchTimer();
      }

      function loadGameProgressContent() {
        const content = document.getElementById("game-progress-content");
        const setNum = gameState.sessionData.currentMatch + 1;
        const currentMatch =
          gameState.sessionData.matches[gameState.sessionData.currentMatch];
        if (!currentMatch.score)
          currentMatch.score = { playerA: 0, playerB: 0 };

        content.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 1.8em; margin-bottom: 20px;">ğŸº CuJu Set ${setNum} Folyamatban</div>
                    <div id="timer-display" style="font-size: 3em; font-weight: bold; color: #FF6B35; margin: 20px 0;">${gameState.selectedTime}</div>
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #FF6B35;">
                        <h3 style="color: #bf360c; margin-bottom: 20px;">ğŸº PONTSZÃM RÃ–GZÃTÃ‰S</h3>
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: center; margin-bottom: 20px;">
                            <div style="text-align: center; background: #FF6B35; color: white; padding: 20px; border-radius: 8px;">
                                <div style="font-size: 1.2em; margin-bottom: 10px;">ğŸ‘¤ JÃTÃ‰KOS A</div>
                                <div id="score-a" style="font-size: 3em; font-weight: bold; margin: 10px 0;">${currentMatch.score.playerA}</div>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <button onclick="changeScore('playerA', 1)" style="background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 1.2em; cursor: pointer;">+1</button>
                                    <button onclick="changeScore('playerA', -1)" style="background: #f44336; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 1.2em; cursor: pointer;">-1</button>
                                </div>
                            </div>
                            <div style="font-size: 2em; color: #6c757d; font-weight: bold;">VS</div>
                            <div style="text-align: center; background: #F7931E; color: white; padding: 20px; border-radius: 8px;">
                                <div style="font-size: 1.2em; margin-bottom: 10px;">ğŸ‘¤ JÃTÃ‰KOS B</div>
                                <div id="score-b" style="font-size: 3em; font-weight: bold; margin: 10px 0;">${currentMatch.score.playerB}</div>
                                <div style="display: flex; justify-content: center; gap: 10px;">
                                    <button onclick="changeScore('playerB', 1)" style="background: #4CAF50; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 1.2em; cursor: pointer;">+1</button>
                                    <button onclick="changeScore('playerB', -1)" style="background: #f44336; color: white; border: none; padding: 10px 15px; border-radius: 4px; font-size: 1.2em; cursor: pointer;">-1</button>
                                </div>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 4px;">
                            <span style="color: #6c757d;">CÃ©l: ${gameState.selectedPoints} pont</span>
                            <span id="score-status" style="margin-left: 20px; font-weight: bold;"></span>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary" onclick="finishMatch()" style="font-size: 1.1em; margin-right: 10px;">âœ… CuJu Set BefejezÃ©se</button>
                        <button class="btn" onclick="cancelMatch()" style="background: #f44336; color: white;">âŒ MegszakÃ­tÃ¡s</button>
                    </div>
                </div>
            `;
        updateScoreStatus();
      }

      // Score & Timer Functions
      function changeScore(player, change) {
        const currentMatch =
          gameState.sessionData.matches[gameState.sessionData.currentMatch];
        if (!currentMatch || !currentMatch.score) return;
        currentMatch.score[player] += change;
        if (currentMatch.score[player] < 0) currentMatch.score[player] = 0;
        document.getElementById(
          `score-${player === "playerA" ? "a" : "b"}`
        ).textContent = currentMatch.score[player];
        updateScoreStatus();
        checkMatchCompletion();
      }

      function updateScoreStatus() {
        const statusDisplay = document.getElementById("score-status");
        if (!statusDisplay) return;
        const currentMatch =
          gameState.sessionData.matches[gameState.sessionData.currentMatch];
        if (!currentMatch || !currentMatch.score) return;
        const { playerA, playerB } = currentMatch.score;
        const target = gameState.selectedPoints;

        if (playerA >= target && playerA > playerB) {
          statusDisplay.textContent = "ğŸ† JÃTÃ‰KOS A VEZET!";
          statusDisplay.style.color = "#FF6B35";
        } else if (playerB >= target && playerB > playerA) {
          statusDisplay.textContent = "ğŸ† JÃTÃ‰KOS B VEZET!";
          statusDisplay.style.color = "#F7931E";
        } else if (playerA === playerB && playerA > 0) {
          statusDisplay.textContent = "ğŸ¤ DÃ–NTETLEN";
          statusDisplay.style.color = "#6c757d";
        } else {
          statusDisplay.textContent = "ğŸº CuJu gyakorlÃ¡s folyamatban...";
          statusDisplay.style.color = "#4CAF50";
        }
      }

      function checkMatchCompletion() {
        const currentMatch =
          gameState.sessionData.matches[gameState.sessionData.currentMatch];
        if (!currentMatch || !currentMatch.score) return;
        const { playerA, playerB } = currentMatch.score;
        const target = gameState.selectedPoints;

        if (playerA >= target || playerB >= target) {
          currentMatch.winner =
            playerA > playerB
              ? "playerA"
              : playerB > playerA
              ? "playerB"
              : "tie";
          setTimeout(() => finishMatch(), 3000);
          const statusDisplay = document.getElementById("score-status");
          if (statusDisplay) {
            statusDisplay.textContent = `ğŸ‰ CUJU SET BEFEJEZVE! (3 mp mÃºlva folytatjuk)`;
            statusDisplay.style.color = "#f44336";
          }
        }
      }

      let matchTimer;
      function startMatchTimer() {
        let timeLeft = gameState.selectedTime;
        const timerDisplay = document.getElementById("timer-display");
        matchTimer = setInterval(() => {
          timeLeft--;
          if (timerDisplay) {
            timerDisplay.textContent = timeLeft;
            timerDisplay.style.color =
              timeLeft <= 10
                ? "#f44336"
                : timeLeft <= 30
                ? "#F7931E"
                : "#FF6B35";
          }
          if (timeLeft <= 0) {
            clearInterval(matchTimer);
            finishMatch();
          }
        }, 1000);
      }

      function finishMatch() {
        if (matchTimer) clearInterval(matchTimer);
        const currentMatch =
          gameState.sessionData.matches[gameState.sessionData.currentMatch];
        currentMatch.endTime = new Date().toISOString();
        currentMatch.result = "completed";

        if (!currentMatch.winner) {
          const { playerA, playerB } = currentMatch.score;
          currentMatch.winner =
            playerA > playerB
              ? "playerA"
              : playerB > playerA
              ? "playerB"
              : "tie";
        }

        gameState.sessionData.currentMatch++;
        if (
          gameState.sessionData.currentMatch >=
          gameState.sessionData.totalMatches
        ) {
          gameState.sessionData.endTime = new Date().toISOString();
          showGameStep("summary");
          loadGameSummaryContent();
        } else {
          showGameStep("ready");
          loadGameReadyContent();
        }
      }

      function cancelMatch() {
        if (matchTimer) clearInterval(matchTimer);
        if (gameState.sessionData.matches.length > 0) {
          const currentMatch =
            gameState.sessionData.matches[gameState.sessionData.currentMatch];
          currentMatch.endTime = new Date().toISOString();
          currentMatch.result = "cancelled";
        }
        gameState.sessionData.endTime = new Date().toISOString();
        showGameStep("summary");
        loadGameSummaryContent();
      }

      function loadGameSummaryContent() {
        const content = document.getElementById("game-summary-content");
        const matches = gameState.sessionData.matches;
        const totalTime = calculateTotalSessionTime();
        let playerAWins = 0,
          playerBWins = 0,
          ties = 0;
        matches.forEach((match) => {
          if (match.winner === "playerA") playerAWins++;
          else if (match.winner === "playerB") playerBWins++;
          else if (match.winner === "tie") ties++;
        });

        let sessionWinner =
          playerAWins > playerBWins
            ? "ğŸ† JÃTÃ‰KOS A MESTER LETT!"
            : playerBWins > playerAWins
            ? "ğŸ† JÃTÃ‰KOS B MESTER LETT!"
            : "ğŸ¤ DÃ–NTETLEN CUJU GYAKORLÃS!";

        content.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2em; margin-bottom: 10px;">ğŸº GÄnCuju GyakorlÃ¡s Befejezve!</div>
                    <div style="font-size: 1.3em; margin-bottom: 30px; color: #FF6B35; font-weight: bold;">${sessionWinner}</div>
                    <div style="background: linear-gradient(135deg, #8e24aa, #ab47bc); color: white; padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <strong>ğŸº 4000 Ã‰VES EREDMÃ‰NY:</strong> Åsi CuJu technikÃ¡k elsajÃ¡tÃ­tva ${totalTime} mÃ¡sodperc alatt!
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                        <div style="background: #fff3e0; padding: 20px; border-radius: 8px; border: 1px solid #FF6B35;">
                            <div style="font-size: 2em; color: #FF6B35; margin-bottom: 10px;">${playerAWins}</div>
                            <div style="color: #6c757d;">ğŸ‘¤ JÃ¡tÃ©kos A GyÅ‘zelmek</div>
                        </div>
                        <div style="background: #fff8e1; padding: 20px; border-radius: 8px; border: 1px solid #F7931E;">
                            <div style="font-size: 2em; color: #F7931E; margin-bottom: 10px;">${playerBWins}</div>
                            <div style="color: #6c757d;">ğŸ‘¤ JÃ¡tÃ©kos B GyÅ‘zelmek</div>
                        </div>
                        <div style="background: #f8f9ff; padding: 20px; border-radius: 8px; border: 1px solid #FFD700;">
                            <div style="font-size: 2em; color: #FFD700; margin-bottom: 10px;">${Math.round(
                              totalTime / 60
                            )}m</div>
                            <div style="color: #6c757d;">Ã–sszes IdÅ‘</div>
                        </div>
                    </div>
                    <div style="background: #fff3e0; padding: 20px; border-radius: 8px; margin: 20px 0; border: 1px solid #FF6B35;">
                        <h4 style="color: #bf360c; margin-bottom: 15px;">ğŸ“ EREDMÃ‰NYEK EXPORTÃLÃSA</h4>
                        <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                            <button onclick="exportGameResults('json')" style="background: #FF6B35; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">ğŸ“„ JSON</button>
                            <button onclick="exportGameResults('csv')" style="background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">ğŸ“Š CSV</button>
                            <button onclick="copyGameResults()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;">ğŸ“‹ VÃ¡gÃ³lap</button>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button onclick="startNewGameSession()" style="background: #FF6B35; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 1.1em; margin-right: 10px;">ğŸ”„ Ãšj CuJu GyakorlÃ¡s</button>
                        <button onclick="backToGenerator()" style="background: #6c757d; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer;">ğŸ  Vissza a GenerÃ¡torhoz</button>
                    </div>
                </div>
            `;
      }

      function calculateTotalSessionTime() {
        if (!gameState.sessionData.startTime || !gameState.sessionData.endTime)
          return 0;
        return Math.round(
          (new Date(gameState.sessionData.endTime) -
            new Date(gameState.sessionData.startTime)) /
            1000
        );
      }

      function startNewGameSession() {
        gameState.isActive = false;
        gameState.sessionData = {
          matches: [],
          totalMatches: 3,
          currentMatch: 0,
          startTime: null,
          endTime: null,
        };
        showGameStep("match-type");
        initializeMatchTypeSelection();
      }

      // Export Functions
      function exportGameResults(format) {
        const sessionData = gameState.sessionData;
        const timestamp = new Date().toISOString().replace(/[:.]/g, "-");

        if (format === "json") {
          const jsonData = {
            gameType: "GanCuju",
            sessionId: `gancuju_${timestamp}`,
            timestamp: new Date().toISOString(),
            configuration: sessionData.configuration,
            generatedResult: sessionData.generatedResult,
            matchType: sessionData.matchType,
            totalMatches: sessionData.totalMatches,
            completedMatches: sessionData.matches.filter(
              (m) => m.result === "completed"
            ).length,
            sessionDuration: calculateTotalSessionTime(),
            matches: sessionData.matches,
            summary: {
              playerAWins: sessionData.matches.filter(
                (m) => m.winner === "playerA"
              ).length,
              playerBWins: sessionData.matches.filter(
                (m) => m.winner === "playerB"
              ).length,
              ties: sessionData.matches.filter((m) => m.winner === "tie")
                .length,
              totalTime: calculateTotalSessionTime(),
            },
          };
          downloadFile(
            JSON.stringify(jsonData, null, 2),
            `gancuju_results_${timestamp}.json`,
            "application/json"
          );
        } else if (format === "csv") {
          let csv =
            "CuJu Set,Player A Score,Player B Score,Winner,Duration,Status\n";
          sessionData.matches.forEach((match) => {
            const playerAScore = match.score ? match.score.playerA : 0;
            const playerBScore = match.score ? match.score.playerB : 0;
            const winner =
              match.winner === "playerA"
                ? "Player A"
                : match.winner === "playerB"
                ? "Player B"
                : match.winner === "tie"
                ? "Tie"
                : "N/A";
            const duration =
              match.endTime && match.startTime
                ? Math.round(
                    (new Date(match.endTime) - new Date(match.startTime)) / 1000
                  )
                : 0;
            csv += `${match.matchNumber},${playerAScore},${playerBScore},${winner},${duration}s,${match.result}\n`;
          });
          downloadFile(csv, `gancuju_results_${timestamp}.csv`, "text/csv");
        }
      }

      function downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }

      function copyGameResults() {
        const sessionData = gameState.sessionData;
        const summary = `ğŸº GÄ€NCUJU EREDMÃ‰NYEK
========================================
ğŸ“… DÃ¡tum: ${new Date().toLocaleDateString("hu-HU")}
â±ï¸ IdÅ‘tartam: ${Math.round(calculateTotalSessionTime() / 60)} perc
ğŸº Set tÃ­pus: ${sessionData.points} pontos

ğŸ“Š Ã–SSZESÃTÅ:
â€¢ JÃ¡tÃ©kos A gyÅ‘zelmek: ${
          sessionData.matches.filter((m) => m.winner === "playerA").length
        }
â€¢ JÃ¡tÃ©kos B gyÅ‘zelmek: ${
          sessionData.matches.filter((m) => m.winner === "playerB").length
        }
â€¢ DÃ¶ntetlenek: ${sessionData.matches.filter((m) => m.winner === "tie").length}

ğŸ“‹ CUJU SET RÃ‰SZLETEK:
${sessionData.matches
  .map((match) => {
    const score = match.score
      ? `${match.score.playerA}-${match.score.playerB}`
      : "N/A";
    const winner =
      match.winner === "playerA"
        ? "A nyert"
        : match.winner === "playerB"
        ? "B nyert"
        : match.winner === "tie"
        ? "DÃ¶ntetlen"
        : "MegszakÃ­tva";
    return `CuJu Set ${match.matchNumber}: ${score} (${winner})`;
  })
  .join("\n")}

ğŸº GenerÃ¡lva: GanBall Games - 4000 Ã©ves Å‘si CuJu`.trim();

        navigator.clipboard
          .writeText(summary)
          .then(() => {
            alert("ğŸ“‹ GÄnCuju eredmÃ©nyek vÃ¡gÃ³lapra mÃ¡solva!");
          })
          .catch(() => {
            alert("âŒ VÃ¡gÃ³lapra mÃ¡solÃ¡s sikertelen");
          });
      }

      function backToGenerator() {
        document
          .getElementById("game-recording-section")
          .classList.remove("active");
        gameState.isActive = false;
        gameState.currentConfig = null;
        gameState.generatedResult = null;
        GENERATED_RESULT = null;
        gameState.sessionData = {
          matches: [],
          totalMatches: 3,
          currentMatch: 0,
          startTime: null,
          endTime: null,
        };
        const results = document.getElementById("results");
        if (results) results.scrollIntoView({ behavior: "smooth" });
      }
    </script>
  </body>
</html>
